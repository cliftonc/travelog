/**
 * Picasa Webalbum Integration jQuery plugin
 * This library was inspired aon pwa by Dieter Raber
 * @name jquery.pwi.js
 * @author Jeroen Diderik - http://www.jdee.nl/
 * @revision 1.2.0
 * @date January 25, 2010
 * @copyright (c) 2009 Jeroen Diderik(www.jdee.nl)
 * @license Creative Commons Attribution-Share Alike 3.0 Netherlands License - http://creativecommons.org/licenses/by-sa/3.0/nl/
 * @Visit http://pwi.googlecode.com/ for more informations, duscussions etc about this library
 */
(function($){var k,opts={};$.fn.pwi=function(g){var h,settings={};g=$.extend({},$.fn.pwi.defaults,g);k=this;function _initialize(){settings=g;ts=new Date().getTime();settings.id=ts;h=$("<div id='pwi_"+ts+"'/>").appendTo(k);h.addClass('pwi_container');_start();return false}function _start(){if(settings.username===''){alert('Make sure you specify at least your username.'+'\n'+'See http://pwi.googlecode.com for more info');return}switch(settings.mode){case'latest':getLatest();break;case'album':getAlbum();break;case'keyword':getAlbum();break;default:getAlbums();break}}function formatDate(a){var b=new Date(Number(a)),$year=b.getUTCFullYear();if($year<1000){$year+=1900}return(settings.months[(b.getUTCMonth())]+" "+b.getUTCDate()+", "+$year)}function formatDateTime(a){var b=new Date(Number(a));$year=b.getUTCFullYear();if($year<1000){$year+=1900}if(b=="Invalid Date"){return a}else{return(b.getUTCDate()+"-"+(b.getUTCMonth()+1)+"-"+$year+" "+b.getUTCHours()+":"+(b.getUTCMinutes()<10?"0"+b.getUTCMinutes():b.getUTCMinutes()))}}function a(a){var b,$d="",$c="",$img_base=a.content.src,$id_base=a.gphoto$id.$t,$c=(a.summary?a.summary.$t:"");if(settings.showPhotoDate){if(a.exif$tags.exif$time){$d=formatDateTime(a.exif$tags.exif$time.$t)}else if(a.gphoto$timestamp){$d=formatDateTime(a.gphoto$timestamp.$t)}else{$d=formatDateTime(a.published.$t)}$d+=" "}$d+=$c.replace(new RegExp("'","g"),"&#39;");b=$("<div class='pwi_photo' style='height:"+(settings.thumbSize+1)+"px;cursor: pointer;'/>");b.append("<a href='"+$img_base+"?imgmax="+settings.photoSize+"' rel='lb-"+settings.username+"' title='"+$d+"'><img src='"+$img_base+"?imgmax="+settings.thumbSize+"&crop="+settings.thumbCrop+"'/></a>");if(settings.showPhotoCaption){if(settings.showPhotoCaptionDate&&settings.showPhotoDate){$c=$d}if(settings.photoCaptionLength>0){$c=$c.substring(0,settings.photoCaptionLength)}b.find("a").append("<br/>"+$c)}return b}function albums(j){var a=$("<div/>"),i=0;while(i<settings.albumMaxResults&&i<j.feed.entry.length){var b=j.feed.entry[i].gphoto$name.$t,$album_date=formatDate(j.feed.entry[i].gphoto$timestamp.$t),$thumb=j.feed.entry[i].media$group.media$thumbnail[0].url.replace(new RegExp("/s160-c/","g"),"/");if($.inArray(b,settings.albums)>-1||settings.albums.length===0){$scAlbum=$("<div class='pwi_album'/>");$scAlbum.bind('click.pwi',b,function(e){e.stopPropagation();settings.page=1;settings.album=e.data;if(typeof(settings.onclickAlbumThumb)==="function"){settings.onclickAlbumThumb(e,settings);return false}else{getAlbum();return false}});$scAlbum.append("<img src='"+$thumb+"?imgmax="+settings.albumThumbSize+"&crop="+settings.albumCrop+"'/>");settings.showAlbumTitles?$scAlbum.append("<br/>"+j.feed.entry[i].title.$t+"<br/>"+(settings.showAlbumdate?$album_date:"")+(settings.showAlbumPhotoCount?"&nbsp;&nbsp;&nbsp;&nbsp;"+j.feed.entry[i].gphoto$numphotos.$t+" "+settings.labels.photos:"")):false;a.append($scAlbum)}i++}a.append("<div style='clear: both;height:0px;'/>");settings.albumstore=j;show(false,a)}function album(j){var a,$scPhotosDesc,$np=j.feed.openSearch$totalResults.$t,$at="",$navRow="",$loc=j.feed.gphoto$location===undefined?"":j.feed.gphoto$location.$t,$ad=j.feed.subtitle===undefined?"":j.feed.subtitle.$t,$album_date=formatDate(j.feed.gphoto$timestamp===undefined?'':j.feed.gphoto$timestamp.$t),$item_plural=($np=="1")?false:true;$at=(j.feed.title==="undefined"||settings.albumTitle.length>0)?settings.albumTitle:j.feed.title.$t;a=$("<div/>");if(settings.mode!='album'){var b=$("<div class='pwi_album_backlink'>"+settings.labels.albums+"</div>").bind('click.pwi',function(e){e.stopPropagation();getAlbums();return false});a.append(b)}if(settings.showAlbumDescription){$scPhotosDesc=$("<div class='pwi_album_description'/>");$scPhotosDesc.append("<div class='title'>"+$at+"</div>");$scPhotosDesc.append("<div class='details'>"+$np+" "+($item_plural?settings.labels.photos:settings.labels.photo)+(settings.showAlbumdate?", "+$album_date:"")+(settings.showAlbumLocation&&$loc?", "+$loc:"")+"</div>");$scPhotosDesc.append("<div class='description'>"+$ad+"</div>");if(settings.showSlideshowLink){if(settings.mode==='keyword'){}else{$scPhotosDesc.append("<div><a href='http://picasaweb.google.com/"+settings.username+"/"+j.feed.gphoto$name.$t+""+((settings.authKey!="")?"?authkey="+settings.authKey:"")+"#slideshow/"+j.feed.entry[0].gphoto$id.$t+"' rel='gb_page_fs[]' target='_new' class='sslink'>"+settings.labels.slideshow+"</a></div>")}}a.append($scPhotosDesc)}if($np>settings.maxResults){$pageCount=($np/settings.maxResults);var c=$("<div class='pwi_prevpage'/>").text(settings.labels.prev),$npage=$("<div class='pwi_nextpage'/>").text(settings.labels.next);$navRow=$("<div class='pwi_pager'/>");if(settings.page>1){c.addClass('link').bind('click.pwi',function(e){e.stopPropagation();settings.page=(parseInt(settings.page)-1);getAlbum();return false})}$navRow.append(c);for(var p=1;p<$pageCount+1;p++){if(p==settings.page){b="<div class='pwi_pager_current'>"+p+"</div> "}else{b=$("<div class='pwi_pager_page'>"+p+"</div>").bind('click.pwi',p,function(e){e.stopPropagation();settings.page=e.data;getAlbum();return false})}$navRow.append(b)}if(settings.page<$pageCount){$npage.addClass('link').bind('click.pwi',function(e){e.stopPropagation();settings.page=(parseInt(settings.page)+1);getAlbum();return false})}$navRow.append($npage);$navRow.append("<div style='clear: both;height:0px;'/>")}if($navRow.length>0&&(settings.showPager==='both'||settings.showPager==='top')){a.append($navRow)}var i=((settings.page-1)*settings.maxResults);while(i<(settings.maxResults*settings.page)&&i<$np){var d=photo(j.feed.entry[i]);a.append(d);i++}if($navRow.length>0&&(settings.showPager==='both'||settings.showPager==='bottom')){a.append($navRow.clone(true))}settings.photostore[settings.album]=j;var f=$(".pwi_photo",a).css(settings.thumbCss);if(typeof(settings.popupExt)==="function"){settings.popupExt(f.find("a[rel='lb-"+settings.username+"']"))}else if(typeof(settings.onclickThumb)==="function"){f.find("a[rel='lb-"+settings.username+"']").bind('click.pwi',clickThumb)}else if(typeof(settings.onclickThumb)!="function"&&$.slimbox){f.find("a[rel='lb-"+settings.username+"']").slimbox(settings.slimbox_config)}show(false,a)}function latest(j){var a=$("<div/>"),$len=j.feed?j.feed.entry.length:0,i=0;while(i<settings.maxResults&&i<$len){var b=photo(j.feed.entry[i]);a.append(b);i++}a.append("<div style='clear: both;height:0px;'> </div>");var c=$("div.pwi_photo",a).css(settings.thumbCss);if(typeof(settings.popupExt)==="function"){settings.popupExt(c.find("a[rel='lb-"+settings.username+"']"))}else if(typeof(settings.onclickThumb)==="function"){c.find("a[rel='lb-"+settings.username+"']").bind('click',clickThumb)}else if(typeof(settings.onclickThumb)!="function"&&$.slimbox){c.find("a[rel='lb-"+settings.username+"']").slimbox(settings.slimbox_config)}show(false,a)}function clickAlbumThumb(a){settings.onclickAlbumThumb(a);return false}function clickThumb(){settings.onclickThumb.call(this);return false}function getAlbums(){if(settings.albumstore.feed){albums(settings.albumstore)}else{show(true,'');var a='http://picasaweb.google.com/data/feed/api/user/'+settings.username+'?kind=album&access='+settings.albumTypes+'&alt=json';$.getJSON(a,'callback=?',albums)}return h}function getAlbum(){if(settings.photostore[settings.album]){album(settings.photostore[settings.album])}else{var a=((settings.page-1)*settings.maxResults)+1;if(settings.mode==='keyword'){var b='http://picasaweb.google.com/data/feed/api/user/'+settings.username+'?alt=json&kind=photo&tag='+settings.keyword+'&max-results='+settings.maxResults+'&start-index='+a+((settings.authKey!="")?"&authkey="+settings.authKey:"")}else{var b='http://picasaweb.google.com/data/feed/api/user/'+settings.username+'/album/'+settings.album+'?kind=photo&alt=json'+((settings.authKey!="")?"&authkey="+settings.authKey:"")}show(true,'');$.getJSON(b,'callback=?',album)}return h}function getLatest(){show(true,'');var a='http://picasaweb.google.com/data/feed/api/user/'+settings.username+(settings.album!=""?'/album/'+settings.album:'')+'?kind=photo&max-results='+settings.maxResults+'&alt=json&q='+((settings.authKey!="")?"&authkey="+settings.authKey:"");$.getJSON(a,'callback=?',latest);return h}function show(a,b){if(a){document.body.style.cursor="wait"}else{document.body.style.cursor="default";h.html(b)}}_initialize()}$.fn.pwi.defaults={mode:'albums',username:'',album:"",authKey:"",albums:[],albumCrop:1,albumTitle:"",albumThumbSize:160,albumMaxResults:999,albumsPerPage:10,albumStartIndex:1,albumTypes:"public",page:1,photoSize:800,maxResults:50,showPager:'bottom',thumbSize:72,thumbCrop:0,thumbCss:{'margin':'5px'},onclickThumb:"",onclickAlbumThumb:"",popupExt:"",showAlbumTitles:true,showAlbumdate:true,showAlbumPhotoCount:true,showAlbumDescription:true,showAlbumLocation:true,showSlideshowLink:true,showPhotoCaption:false,showPhotoCaptionDate:false,photoCaptionLength:0,showPhotoDownload:false,showPhotoDate:true,labels:{photo:"photo",photos:"photos",albums:"Back to albums",slideshow:"Display slideshow",loading:"PWI fetching data...",page:"Page",prev:"Previous",next:"Next",devider:"|"},months:["January","February","March","April","May","June","July","August","September","October","November","December"],slimbox_config:{loop:false,overlayOpacity:0.6,overlayFadeDuration:400,resizeDuration:400,resizeEasing:"swing",initialWidth:250,initlaHeight:250,imageFadeDuration:400,captionAnimationDuration:400,counterText:"{x}/{y}",closeKeys:[27,88,67,70],prevKeys:[37,80],nextKeys:[39,83]},blockUIConfig:{message:"<div class='lbLoading pwi_loader'>loading...</div>",css:"pwi_loader"},albumstore:{},photostore:{},token:""}})(jQuery);